<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>pDOOM – Cyber‑punk Probability Curve</title>
<!-- Plotly CDN -->
<script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
<style>
  body {
    margin: 0;
    background:#0b0b0b;               /* dark twilight */
    color:#e0e0e0;
    font-family: "Consolas", monospace;
  }
  #graph {
    width: 100vw;
    height: 90vh;
  }
  .control-panel {
    display:flex;
    flex-wrap:wrap;
    gap:1rem;
    padding:1rem;
    background:#111;
    border-top:2px solid #444;
  }
  .control-panel label {
    display:flex;
    flex-direction:column;
    font-size:0.9rem;
    color:#a0ff7a;                     /* cyber‑green */
  }
  input[type=range] {
    width:200px;
  }
</style>
</head>
<body>

<div id="graph"></div>

<div class="control-panel">
  <!-- exponent slider -->
  <label>
    Exponent (b)
    <input type="range" id="expSlider" min="0.1" max="5" step="0.01" value="2">
  </label>

  <!-- horizontal offset slider -->
  <label>
    X‑offset (Δx)
    <input type="range" id="offsetSlider" min="-2" max="2" step="0.01" value="0">
  </label>

  <!-- discontinuity slider (top‑half shift) -->
  <label>
    Top‑half shift (δ)
    <input type="range" id="shiftSlider" min="-2" max="2" step="0.01" value="0">
  </label>

  <!-- noise amplitude slider -->
  <label>
    Noise amp.
    <input type="range" id="noiseSlider" min="0" max="0.05" step="0.001" value="0.01">
  </label>
</div>

<script>
/* -------------------------------------------------
   pDOOM curve: y = X^b + C   (0 < y < 1)
   - X is year (2020‑2030)
   - C is chosen so that y(2027)=1
   - Additional sliders modify exponent, offset,
     a discontinuity at y=0.5, and noise.
   ------------------------------------------------- */

// DOM elements
const expSlider   = document.getElementById('expSlider');
const offsetSlider= document.getElementById('offsetSlider');
const shiftSlider = document.getElementById('shiftSlider');
const noiseSlider = document.getElementById('noiseSlider');
const graphDiv    = document.getElementById('graph');

// base data points (year → probability) used for fitting C
const basePoints = [
  {x:2025, y:0.05},
  {x:2026, y:0.20},
  {x:2027, y:1.00}
];

// compute constant C for a given exponent b
function computeC(b){
  // use the point (2027,1) → 1 = 2027^b + C  => C = 1 - 2027^b
  return 1 - Math.pow(2027, b);
}

// generate the curve (including offset, shift, noise)
function generateData(){
  const b      = parseFloat(expSlider.value);
  const dx     = parseFloat(offsetSlider.value);
  const dTop   = parseFloat(shiftSlider.value);
  const noiseA = parseFloat(noiseSlider.value);
  const C      = computeC(b);

  const xs = [];
  const ys = [];

  for(let year=2020; year<=2030; year+=0.01){
    // apply horizontal offset
    const x = year + dx;

    // raw value before discontinuity
    let y = Math.pow(x, b) + C;

    // clamp to (0,1) – the probability axis
    y = Math.max(0, Math.min(1, y));

    // create a discontinuity at y = 0.5
    if (y > 0.5){
      // shift only the upper branch
      y = Math.min(1, y + dTop);
    }

    // add a little Perlin‑like noise (simple sinusoidal jitter)
    const noise = noiseA * Math.sin(50 * x);
    y = Math.max(0, Math.min(1, y + noise));

    xs.push(year);
    ys.push(y);
  }
  return {x:xs, y:ys};
}

// initial plot
function draw(){
  const data = generateData();

  const trace = {
    x: data.x,
    y: data.y,
    mode: 'lines',
    line: {
      width: 4,
      color: 'rgba(255, 40, 150, 0.9)'   // cyber‑pink/red
    },
    hoverinfo: 'x+y'
  };

  const layout = {
    paper_bgcolor: '#0b0b0b',
    plot_bgcolor:  '#0b0b0b',
    xaxis: {
      title: 'Year',
      range: [2020,2030],
      tickfont:{color:'#a0ff7a'},
      titlefont:{color:'#a0ff7a'}
    },
    yaxis: {
      title: 'pDOOM (probability)',
      range: [0,1],
      tickfont:{color:'#a0ff7a'},
      titlefont:{color:'#a0ff7a'}
    },
    margin:{l:60,r:20,b:60,t:20},
    font:{color:'#e0e0e0'}
  };

  Plotly.newPlot(graphDiv, [trace], layout, {responsive:true});
}

// update on any slider change
[expSlider, offsetSlider, shiftSlider, noiseSlider].forEach(s=>{
  s.addEventListener('input', draw);
});

// first render
draw();
</script>

</body>
</html>

